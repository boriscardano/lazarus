# Lazarus Configuration Example
# This file shows practical examples of configuring Lazarus for real-world scenarios

# Scripts to monitor and heal
scripts:
  # Example 1: Daily Backup Script
  - name: daily-backup
    path: scripts/backup.sh
    description: Backs up database to S3
    schedule: "0 2 * * *"  # 2 AM daily
    timeout: 600
    working_dir: null
    allowed_files:
      - "scripts/backup.sh"
      - "config/backup-config.yaml"
    forbidden_files:
      - "secrets.yaml"
      - ".env"
    environment:
      - DATABASE_URL
      - S3_BUCKET
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
    idempotent: true
    success_criteria:
      exit_code: 0
      contains: "Backup completed successfully"

  # Example 2: Data Sync Script
  - name: sync-data
    path: scripts/sync_data.py
    description: Syncs data between systems
    schedule: "0 */6 * * *"  # Every 6 hours
    timeout: 900
    allowed_files:
      - "scripts/**/*.py"
      - "config/*.yaml"
    environment:
      - API_KEY
      - SOURCE_DB
      - TARGET_DB
    custom_prompt: |
      This script synchronizes data between two databases.
      It must maintain referential integrity and should be idempotent.
      Common issues:
      - Connection timeouts (increase timeout or add retry logic)
      - Schema mismatches (check version compatibility)
      - Duplicate key errors (add conflict resolution)

  # Example 3: Report Generation
  - name: weekly-report
    path: scripts/generate_report.py
    description: Generates weekly analytics report
    schedule: "0 9 * * 1"  # Monday 9 AM
    timeout: 300
    success_criteria:
      exit_code: 0
      contains: "Report generated"
      regex_match: "Processed \\d+ records"

# Healing configuration
healing:
  max_attempts: 3
  timeout_per_attempt: 300
  total_timeout: 900
  claude_model: claude-sonnet-4-5-20250929
  max_turns: 30
  allowed_tools: []  # Empty = all tools allowed
  forbidden_tools:
    - "Bash"  # Prevent Claude from running arbitrary commands (optional)

# Notifications
notifications:
  # Slack notifications
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#ops-alerts"
    on_success: true
    on_failure: true

  # Email notifications
  email:
    smtp_host: smtp.gmail.com
    smtp_port: 587
    username: "${EMAIL_USERNAME}"
    password: "${EMAIL_PASSWORD}"
    from_addr: lazarus@example.com
    to_addrs:
      - ops-team@example.com
      - devops@example.com
    on_success: false  # Only notify on failures
    on_failure: true
    use_tls: true

  # GitHub Issues for failures
  github_issues:
    repo: myorg/myrepo
    labels:
      - lazarus
      - auto-heal
      - bug
    on_failure: true
    assignees:
      - devops-lead

# Git and PR configuration
git:
  create_pr: true
  branch_prefix: lazarus/fix
  draft_pr: false
  auto_merge: false
  commit_message_template: |
    fix: {script_name} - Auto-healed by Lazarus

    {healing_summary}

    Healing attempts: {attempt_count}
    Duration: {duration}s

    Co-authored-by: Lazarus <lazarus@example.com>
  pr_title_template: "fix: Auto-heal {script_name}"
  pr_body_template: |
    ## Auto-Healing Summary

    **Script:** `{script_path}`
    **Status:** {status}
    **Attempts:** {attempt_count}
    **Duration:** {duration}s

    ### Error
    ```
    {original_error}
    ```

    ### Fix Applied
    {claude_explanation}

    ### Files Changed
    {files_changed}

    ### Verification
    {verification_result}

    ---
    *Auto-generated by Lazarus Self-Healing System*

# Security configuration
security:
  # Additional patterns to redact (beyond built-in patterns)
  additional_patterns:
    - '(?i)(api[_-]?token)[\s=:]+["\']?([a-zA-Z0-9_\-]{20,})["\']?'
    - '(?i)(client[_-]?id)[\s=:]+["\']?([a-zA-Z0-9_\-]{20,})["\']?'
    - '(?i)(stripe[_-]?key)[\s=:]+["\']?([a-zA-Z0-9_\-]{20,})["\']?'

  # Environment variables that are safe to expose
  safe_env_vars:
    - PATH
    - HOME
    - USER
    - SHELL
    - LANG
    - PWD
    - TERM
    - NODE_ENV
    - PYTHON_VERSION

# Logging configuration
logging:
  level: INFO
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: logs/lazarus.log
  rotation: 10  # MB
  retention: 10  # number of rotated log files
  console: true
